export class AchievementModel {
  id: string = ''
  title: string = ''
  description: string = ''
  icon: string = ''
  isUnlocked: boolean = false
  unlockedDate: string = ''
  progress: number = 0
  maxProgress: number = 1
  category: string = ''
  rarity: 'common' | 'rare' | 'epic' | 'legendary' = 'common'
  createdAt: string = ''

  constructor(
    id?: string,
    title?: string,
    description?: string,
    icon?: string,
    category?: string,
    maxProgress?: number,
    rarity?: 'common' | 'rare' | 'epic' | 'legendary'
  ) {
    if (id) this.id = id
    if (title) this.title = title
    if (description) this.description = description
    if (icon) this.icon = icon
    if (category) this.category = category
    if (maxProgress) this.maxProgress = maxProgress
    if (rarity) this.rarity = rarity
    this.createdAt = new Date().toISOString()
  }

  // è·å–è¿›åº¦ç™¾åˆ†æ¯”
  getProgressPercentage(): number {
    if (this.maxProgress === 0) return 0
    return Math.round((this.progress / this.maxProgress) * 100)
  }

  // æ£€æŸ¥æ˜¯å¦å·²å®Œæˆ
  isCompleted(): boolean {
    return this.progress >= this.maxProgress
  }

  // æ›´æ–°è¿›åº¦
  updateProgress(newProgress: number): void {
    this.progress = Math.min(newProgress, this.maxProgress)
    if (this.isCompleted() && !this.isUnlocked) {
      this.unlock()
    }
  }

  // å¢åŠ è¿›åº¦
  addProgress(amount: number = 1): void {
    this.updateProgress(this.progress + amount)
  }

  // è§£é”æˆå°±
  unlock(): void {
    this.isUnlocked = true
    this.unlockedDate = new Date().toISOString().split('T')[0] // YYYY-MM-DDæ ¼å¼
    this.progress = this.maxProgress
  }

  // è·å–ç¨€æœ‰åº¦é¢œè‰²
  getRarityColor(): string {
    switch (this.rarity) {
      case 'common': return '#4CAF50'
      case 'rare': return '#2196F3'
      case 'epic': return '#9C27B0'
      case 'legendary': return '#FF9800'
      default: return '#666666'
    }
  }

  // è·å–ç¨€æœ‰åº¦åç§°
  getRarityName(): string {
    switch (this.rarity) {
      case 'common': return 'æ™®é€š'
      case 'rare': return 'ç¨€æœ‰'
      case 'epic': return 'å²è¯—'
      case 'legendary': return 'ä¼ è¯´'
      default: return 'æœªçŸ¥'
    }
  }

  // è·å–æ ¼å¼åŒ–çš„è§£é”æ—¥æœŸ
  getFormattedUnlockedDate(): string {
    if (!this.unlockedDate) return ''
    const date = new Date(this.unlockedDate)
    return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`
  }

  // æ£€æŸ¥æ˜¯å¦å¯ä»¥æ˜¾ç¤ºè¿›åº¦æ¡
  shouldShowProgress(): boolean {
    return !this.isUnlocked && this.maxProgress > 1
  }

  // è·å–è¿›åº¦æ–‡æœ¬
  getProgressText(): string {
    return `${this.progress}/${this.maxProgress}`
  }

  // é™æ€æ–¹æ³•ï¼šåˆ›å»ºé»˜è®¤æˆå°±åˆ—è¡¨
  static getDefaultAchievements(): AchievementModel[] {
    const achievements: AchievementModel[] = []

    // å­¦ä¹ æˆå°±
    const firstQuestion = new AchievementModel('first_question', 'åˆå­¦è€…', 'å®Œæˆç¬¬ä¸€é“é¢˜ç›®', 'ğŸ¯', 'å­¦ä¹ æˆå°±', 1, 'common')
    firstQuestion.unlock()
    achievements.push(firstQuestion)

    const answer10 = new AchievementModel('answer_10', 'å°è¯•ç‰›åˆ€', 'ç´¯è®¡ç­”å¯¹10é“é¢˜ç›®', 'ğŸ“š', 'å­¦ä¹ æˆå°±', 10, 'common')
    answer10.unlock()
    achievements.push(answer10)

    const answer50 = new AchievementModel('answer_50', 'å‹¤å­¦è‹¦ç»ƒ', 'ç´¯è®¡ç­”å¯¹50é“é¢˜ç›®', 'ğŸ†', 'å­¦ä¹ æˆå°±', 50, 'rare')
    answer50.updateProgress(23)
    achievements.push(answer50)

    // è€ƒæ ¸æˆå°±
    const firstExam = new AchievementModel('first_exam', 'è€ƒæ ¸æ–°æ‰‹', 'å®Œæˆç¬¬ä¸€æ¬¡è€ƒæ ¸', 'ğŸ“', 'è€ƒæ ¸æˆå°±', 1, 'common')
    achievements.push(firstExam)

    const examPerfect = new AchievementModel('exam_perfect', 'å®Œç¾ç­”å·', 'åœ¨è€ƒæ ¸ä¸­è·å¾—æ»¡åˆ†', 'â­', 'è€ƒæ ¸æˆå°±', 1, 'epic')
    achievements.push(examPerfect)

    // è¿ç»­å­¦ä¹ 
    const streak7 = new AchievementModel('streak_7', 'åšæŒä¸æ‡ˆ', 'è¿ç»­å­¦ä¹ 7å¤©', 'ğŸ”¥', 'è¿ç»­å­¦ä¹ ', 7, 'rare')
    streak7.updateProgress(3)
    achievements.push(streak7)

    const streak30 = new AchievementModel('streak_30', 'å­¦ä¹ è¾¾äºº', 'è¿ç»­å­¦ä¹ 30å¤©', 'ğŸ’', 'è¿ç»­å­¦ä¹ ', 30, 'legendary')
    streak30.updateProgress(3)
    achievements.push(streak30)

    // ç‰¹æ®Šæˆå°±
    const nightOwl = new AchievementModel('night_owl', 'å¤œçŒ«å­', 'åœ¨æ™šä¸Š11ç‚¹åå®Œæˆå­¦ä¹ ', 'ğŸ¦‰', 'ç‰¹æ®Šæˆå°±', 1, 'rare')
    achievements.push(nightOwl)

    return achievements
  }
}